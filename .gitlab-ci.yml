image: maven:3.5.3-jdk-8

stages:
- build_jar
- build_wrappers

cache:
  key: "$CI_PIPELINE_ID"
  paths:
  - launch4j-3.12-linux-x64.tgz

jar:
  stage: build_jar
  script:
  - apt-get update -qq && apt-get install -y -qq openjfx
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar -Dtestfx.robot=glass -Dglass.platform=Monocle -Dmonocle.platform=Headless -Dprism.order=sw -Dsonar.host.url=https://sonarcloud.io -Dsonar.organization=sudiamanj-github -Dsonar.login=$SONAR_TOKEN
  - cp target/tunejar-1.0-jar-with-dependencies.jar TuneJar.jar
  artifacts:
    paths:
    - TuneJar.jar

exe:
  stage: build_wrappers
  script:
  - wget -nc https://astuteinternet.dl.sourceforge.net/project/launch4j/launch4j-3/3.12/launch4j-3.12-linux-x64.tgz
  - tar -xvzf launch4j-3.12-linux-x64.tgz
  - ./launch4j/launch4j launch4j.xml
  artifacts:
    paths:
    - TuneJar.exe
